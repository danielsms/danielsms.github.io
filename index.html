<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.6/d3.min.js"></script>
	<link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet">
	<script src="points.js"></script>
	<style type="text/css">
		.container{
			display:block;
		}
		#primavera{
			position:absolute;
			color:white;
			top:274px;
			left:5px;
			font-size:60px;
			font-family:'PT Sans',sans-serif;
			z-index:1000;
			width:512px;
			text-align:center;
			line-height:64px;
			text-shadow:1px 1px 1px #000;
		}
	</style>
</head>
<body>
<div class="container"></div>
<div id="primavera" style="display:none">Primavera<br/>H2020 project</div>
<script type="text/javascript">
	var width = 512,
		height = 512,
		border = 0,
		context = [];
	var objectContainer = d3.select(".container");
	var svg = objectContainer.append("svg")
		.attr("height", height)
		.attr("width", width);
	function draw(pixels,id){
		var pixelGroup = svg.append("g").attr("id","pixels"+id);
		pixels = pixelGroup.selectAll(".pixel")
			.data(pixels)
			.enter().append("rect")
				.attr("class",'pixel')
				.style("fill",'#ffffff')
				.attr("x",function(d){return d.x})
				.attr("y",function(d){return d.y})
				.attr("height",function(d){
					return d.h;
				})
				.attr("width",function(d){
					return d.w;
				});
	}
	function drawAnim(pixels,id,delay){
		var pixelGroup = svg.append("g").attr("id","pixels"+id);
		pixels = pixelGroup.selectAll(".pixel")
			.data(pixels)
			.enter().append("rect")
				.attr("class",'pixel')
				.style("fill",function(d){return d.c;})
				.attr("x",function(d){return d.x+d.w/2})
				.attr("y",function(d){return d.y+d.h/2})
				.attr("height",0)
				.attr("width",0);
		pixels.transition()
				.delay(function(d){return delay+delay*Math.random();})
				.attr("x",function(d){return d.x})
				.attr("y",function(d){return d.y})
				.attr("height",function(d){return d.h;})
				.attr("width",function(d){return d.w;})
			.duration(250);
	}
	window.onload = function(){
			var delay = 500;
		for(var i=0;i<pixels.length;i++){
			if(i==0){
				draw(pixels[i],i);
			}else{
				drawAnim(pixels[i],i,delay+(i-1)*delay);
			}
		}
		setTimeout(function(){
			document.getElementById('primavera').style.display = 'block';
		},delay*(2+pixels.length));
	}
</script>
</body>
</html>
